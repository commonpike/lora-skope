#!/bin/bash

DATADIR=`dirname $0`/../training_data
echo $DATADIR

export PYTORCH_MPS_HIGH_WATERMARK_RATIO=0.0   # (optional) lift VRAM cap


accelerate launch diffusers/examples/dreambooth/train_dreambooth_lora.py \
  --pretrained_model_name_or_path="runwayml/stable-diffusion-v1-5" \
  --instance_data_dir="$DATADIR" \
  --instance_prompt="<stdio.pike> <skope>" \
  --resolution=512 \
  --train_batch_size=1 \
  --max_train_steps=800 \
  --learning_rate=1e-4 \
  --output_dir="output_lora" \
  --checkpointing_steps=200 \
  --gradient_checkpointing \
  --report_to="tensorboard"    # required by lora
#  --enable_xformers_memory_efficient_attention \ # fails on m1
#  --mixed_precision="fp16" \ #not on apple gpu
